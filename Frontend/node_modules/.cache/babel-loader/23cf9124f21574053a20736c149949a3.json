{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var _extendStatics = function extendStatics(d, b) {\n    _extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) {\n        if (b.hasOwnProperty(p)) d[p] = b[p];\n      }\n    };\n\n    return _extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    _extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar Util_1 = require(\"../Util\");\n\nvar Factory_1 = require(\"../Factory\");\n\nvar Node_1 = require(\"../Node\");\n\nvar Shape_1 = require(\"../Shape\");\n\nvar Rect_1 = require(\"./Rect\");\n\nvar Group_1 = require(\"../Group\");\n\nvar Global_1 = require(\"../Global\");\n\nvar Validators_1 = require(\"../Validators\");\n\nvar Global_2 = require(\"../Global\");\n\nvar EVENTS_NAME = 'tr-konva';\nvar ATTR_CHANGE_LIST = ['resizeEnabledChange', 'rotateAnchorOffsetChange', 'rotateEnabledChange', 'enabledAnchorsChange', 'anchorSizeChange', 'borderEnabledChange', 'borderStrokeChange', 'borderStrokeWidthChange', 'borderDashChange', 'anchorStrokeChange', 'anchorStrokeWidthChange', 'anchorFillChange', 'anchorCornerRadiusChange', 'ignoreStrokeChange'].map(function (e) {\n  return e + (\".\" + EVENTS_NAME);\n}).join(' ');\nvar NODE_RECT = 'nodeRect';\nvar TRANSFORM_CHANGE_STR = ['widthChange', 'heightChange', 'scaleXChange', 'scaleYChange', 'skewXChange', 'skewYChange', 'rotationChange', 'offsetXChange', 'offsetYChange', 'transformsEnabledChange', 'strokeWidthChange'].map(function (e) {\n  return e + (\".\" + EVENTS_NAME);\n}).join(' ');\nvar ANGLES = {\n  'top-left': -45,\n  'top-center': 0,\n  'top-right': 45,\n  'middle-right': -90,\n  'middle-left': 90,\n  'bottom-left': -135,\n  'bottom-center': 180,\n  'bottom-right': 135\n};\nvar TOUCH_DEVICE = ('ontouchstart' in Global_1.Konva._global);\n\nfunction getCursor(anchorName, rad, isMirrored) {\n  if (anchorName === 'rotater') {\n    return 'crosshair';\n  }\n\n  rad += Util_1.Util._degToRad(ANGLES[anchorName] || 0);\n\n  if (isMirrored) {\n    rad *= -1;\n  }\n\n  var angle = (Util_1.Util._radToDeg(rad) % 360 + 360) % 360;\n\n  if (Util_1.Util._inRange(angle, 315 + 22.5, 360) || Util_1.Util._inRange(angle, 0, 22.5)) {\n    return 'ns-resize';\n  } else if (Util_1.Util._inRange(angle, 45 - 22.5, 45 + 22.5)) {\n    return 'nesw-resize';\n  } else if (Util_1.Util._inRange(angle, 90 - 22.5, 90 + 22.5)) {\n    return 'ew-resize';\n  } else if (Util_1.Util._inRange(angle, 135 - 22.5, 135 + 22.5)) {\n    return 'nwse-resize';\n  } else if (Util_1.Util._inRange(angle, 180 - 22.5, 180 + 22.5)) {\n    return 'ns-resize';\n  } else if (Util_1.Util._inRange(angle, 225 - 22.5, 225 + 22.5)) {\n    return 'nesw-resize';\n  } else if (Util_1.Util._inRange(angle, 270 - 22.5, 270 + 22.5)) {\n    return 'ew-resize';\n  } else if (Util_1.Util._inRange(angle, 315 - 22.5, 315 + 22.5)) {\n    return 'nwse-resize';\n  } else {\n    Util_1.Util.error('Transformer has unknown angle for cursor detection: ' + angle);\n    return 'pointer';\n  }\n}\n\nvar ANCHORS_NAMES = ['top-left', 'top-center', 'top-right', 'middle-right', 'middle-left', 'bottom-left', 'bottom-center', 'bottom-right'];\nvar MAX_SAFE_INTEGER = 100000000;\n\nvar Transformer = function (_super) {\n  __extends(Transformer, _super);\n\n  function Transformer(config) {\n    var _this = _super.call(this, config) || this;\n\n    _this._transforming = false;\n\n    _this._createElements();\n\n    _this._handleMouseMove = _this._handleMouseMove.bind(_this);\n    _this._handleMouseUp = _this._handleMouseUp.bind(_this);\n    _this.update = _this.update.bind(_this);\n\n    _this.on(ATTR_CHANGE_LIST, _this.update);\n\n    if (_this.getNode()) {\n      _this.update();\n    }\n\n    return _this;\n  }\n\n  Transformer.prototype.attachTo = function (node) {\n    this.setNode(node);\n    return this;\n  };\n\n  Transformer.prototype.setNode = function (node) {\n    var _this = this;\n\n    if (this._node) {\n      this.detach();\n    }\n\n    this._node = node;\n\n    this._resetTransformCache();\n\n    var additionalEvents = node._attrsAffectingSize.map(function (prop) {\n      return prop + 'Change.' + EVENTS_NAME;\n    }).join(' ');\n\n    var onChange = function onChange() {\n      _this._resetTransformCache();\n\n      if (!_this._transforming) {\n        _this.update();\n      }\n    };\n\n    node.on(additionalEvents, onChange);\n    node.on(TRANSFORM_CHANGE_STR, onChange);\n    node.on(\"xChange.\" + EVENTS_NAME + \" yChange.\" + EVENTS_NAME, function () {\n      return _this._resetTransformCache();\n    });\n    var elementsCreated = !!this.findOne('.top-left');\n\n    if (elementsCreated) {\n      this.update();\n    }\n\n    return this;\n  };\n\n  Transformer.prototype.getNode = function () {\n    return this._node;\n  };\n\n  Transformer.prototype.getActiveAnchor = function () {\n    return this._movingAnchorName;\n  };\n\n  Transformer.prototype.detach = function () {\n    if (this.getNode()) {\n      this.getNode().off('.' + EVENTS_NAME);\n      this._node = undefined;\n    }\n\n    this._resetTransformCache();\n  };\n\n  Transformer.prototype._resetTransformCache = function () {\n    this._clearCache(NODE_RECT);\n\n    this._clearCache('transform');\n\n    this._clearSelfAndDescendantCache('absoluteTransform');\n  };\n\n  Transformer.prototype._getNodeRect = function () {\n    return this._getCache(NODE_RECT, this.__getNodeRect);\n  };\n\n  Transformer.prototype.__getNodeRect = function () {\n    var node = this.getNode();\n\n    if (!node) {\n      return {\n        x: -MAX_SAFE_INTEGER,\n        y: -MAX_SAFE_INTEGER,\n        width: 0,\n        height: 0,\n        rotation: 0\n      };\n    }\n\n    if (node.parent && this.parent && node.parent !== this.parent) {\n      Util_1.Util.warn('Transformer and attached node have different parents. Konva does not support such case right now. Please move Transformer to the parent of attaching node.');\n    }\n\n    var rect = node.getClientRect({\n      skipTransform: true,\n      skipShadow: true,\n      skipStroke: this.ignoreStroke()\n    });\n    var rotation = Global_1.Konva.getAngle(node.rotation());\n    var dx = rect.x * node.scaleX() - node.offsetX() * node.scaleX();\n    var dy = rect.y * node.scaleY() - node.offsetY() * node.scaleY();\n    return {\n      x: node.x() + dx * Math.cos(rotation) + dy * Math.sin(-rotation),\n      y: node.y() + dy * Math.cos(rotation) + dx * Math.sin(rotation),\n      width: rect.width * node.scaleX(),\n      height: rect.height * node.scaleY(),\n      rotation: node.rotation()\n    };\n  };\n\n  Transformer.prototype.getX = function () {\n    return this._getNodeRect().x;\n  };\n\n  Transformer.prototype.getY = function () {\n    return this._getNodeRect().y;\n  };\n\n  Transformer.prototype.getRotation = function () {\n    return this._getNodeRect().rotation;\n  };\n\n  Transformer.prototype.getWidth = function () {\n    return this._getNodeRect().width;\n  };\n\n  Transformer.prototype.getHeight = function () {\n    return this._getNodeRect().height;\n  };\n\n  Transformer.prototype._createElements = function () {\n    this._createBack();\n\n    ANCHORS_NAMES.forEach(function (name) {\n      this._createAnchor(name);\n    }.bind(this));\n\n    this._createAnchor('rotater');\n  };\n\n  Transformer.prototype._createAnchor = function (name) {\n    var _this = this;\n\n    var anchor = new Rect_1.Rect({\n      stroke: 'rgb(0, 161, 255)',\n      fill: 'white',\n      strokeWidth: 1,\n      name: name + ' _anchor',\n      dragDistance: 0,\n      draggable: true,\n      hitStrokeWidth: TOUCH_DEVICE ? 10 : 'auto'\n    });\n    var self = this;\n    anchor.on('mousedown touchstart', function (e) {\n      self._handleMouseDown(e);\n    });\n    anchor.on('dragstart', function (e) {\n      e.cancelBubble = true;\n    });\n    anchor.on('dragmove', function (e) {\n      e.cancelBubble = true;\n    });\n    anchor.on('dragend', function (e) {\n      e.cancelBubble = true;\n    });\n    anchor.on('mouseenter', function () {\n      var rad = Global_1.Konva.getAngle(_this.getAbsoluteRotation());\n\n      var scale = _this.getNode().getAbsoluteScale();\n\n      var isMirrored = scale.y * scale.x < 0;\n      var cursor = getCursor(name, rad, isMirrored);\n      anchor.getStage().content.style.cursor = cursor;\n      _this._cursorChange = true;\n    });\n    anchor.on('mouseout', function () {\n      if (!anchor.getStage() || !anchor.getParent()) {\n        return;\n      }\n\n      anchor.getStage().content.style.cursor = '';\n      _this._cursorChange = false;\n    });\n    this.add(anchor);\n  };\n\n  Transformer.prototype._createBack = function () {\n    var back = new Shape_1.Shape({\n      name: 'back',\n      width: 0,\n      height: 0,\n      listening: false,\n      sceneFunc: function sceneFunc(ctx) {\n        var tr = this.getParent();\n        var padding = tr.padding();\n        ctx.beginPath();\n        ctx.rect(-padding, -padding, this.width() + padding * 2, this.height() + padding * 2);\n        ctx.moveTo(this.width() / 2, -padding);\n\n        if (tr.rotateEnabled()) {\n          ctx.lineTo(this.width() / 2, -tr.rotateAnchorOffset() * Util_1.Util._sign(this.height()) - padding);\n        }\n\n        ctx.fillStrokeShape(this);\n      }\n    });\n    this.add(back);\n  };\n\n  Transformer.prototype._handleMouseDown = function (e) {\n    this._movingAnchorName = e.target.name().split(' ')[0];\n\n    var attrs = this._getNodeRect();\n\n    var width = attrs.width;\n    var height = attrs.height;\n    var hypotenuse = Math.sqrt(Math.pow(width, 2) + Math.pow(height, 2));\n    this.sin = Math.abs(height / hypotenuse);\n    this.cos = Math.abs(width / hypotenuse);\n    window.addEventListener('mousemove', this._handleMouseMove);\n    window.addEventListener('touchmove', this._handleMouseMove);\n    window.addEventListener('mouseup', this._handleMouseUp, true);\n    window.addEventListener('touchend', this._handleMouseUp, true);\n    this._transforming = true;\n\n    this._fire('transformstart', {\n      evt: e,\n      target: this.getNode()\n    });\n\n    this.getNode()._fire('transformstart', {\n      evt: e,\n      target: this.getNode()\n    });\n  };\n\n  Transformer.prototype._handleMouseMove = function (e) {\n    var x, y, newHypotenuse;\n    var anchorNode = this.findOne('.' + this._movingAnchorName);\n    var stage = anchorNode.getStage();\n    stage.setPointersPositions(e);\n    anchorNode.setAbsolutePosition(stage.getPointerPosition());\n    var keepProportion = this.keepRatio() || e.shiftKey;\n    var padding = this.padding();\n\n    if (this._movingAnchorName === 'top-left') {\n      if (keepProportion) {\n        newHypotenuse = Math.sqrt(Math.pow(this.findOne('.bottom-right').x() - anchorNode.x() - padding * 2, 2) + Math.pow(this.findOne('.bottom-right').y() - anchorNode.y() - padding * 2, 2));\n        var reverseX = this.findOne('.top-left').x() > this.findOne('.bottom-right').x() ? -1 : 1;\n        var reverseY = this.findOne('.top-left').y() > this.findOne('.bottom-right').y() ? -1 : 1;\n        x = newHypotenuse * this.cos * reverseX;\n        y = newHypotenuse * this.sin * reverseY;\n        this.findOne('.top-left').x(this.findOne('.bottom-right').x() - x - padding * 2);\n        this.findOne('.top-left').y(this.findOne('.bottom-right').y() - y - padding * 2);\n      }\n    } else if (this._movingAnchorName === 'top-center') {\n      this.findOne('.top-left').y(anchorNode.y());\n    } else if (this._movingAnchorName === 'top-right') {\n      if (keepProportion) {\n        newHypotenuse = Math.sqrt(Math.pow(anchorNode.x() - this.findOne('.bottom-left').x() - padding * 2, 2) + Math.pow(this.findOne('.bottom-left').y() - anchorNode.y() - padding * 2, 2));\n        var reverseX = this.findOne('.top-right').x() < this.findOne('.top-left').x() ? -1 : 1;\n        var reverseY = this.findOne('.top-right').y() > this.findOne('.bottom-left').y() ? -1 : 1;\n        x = newHypotenuse * this.cos * reverseX;\n        y = newHypotenuse * this.sin * reverseY;\n        this.findOne('.top-right').x(x + padding);\n        this.findOne('.top-right').y(this.findOne('.bottom-left').y() - y - padding * 2);\n      }\n\n      var pos = anchorNode.position();\n      this.findOne('.top-left').y(pos.y);\n      this.findOne('.bottom-right').x(pos.x);\n    } else if (this._movingAnchorName === 'middle-left') {\n      this.findOne('.top-left').x(anchorNode.x());\n    } else if (this._movingAnchorName === 'middle-right') {\n      this.findOne('.bottom-right').x(anchorNode.x());\n    } else if (this._movingAnchorName === 'bottom-left') {\n      if (keepProportion) {\n        newHypotenuse = Math.sqrt(Math.pow(this.findOne('.top-right').x() - anchorNode.x() - padding * 2, 2) + Math.pow(anchorNode.y() - this.findOne('.top-right').y() - padding * 2, 2));\n        var reverseX = this.findOne('.top-right').x() < this.findOne('.bottom-left').x() ? -1 : 1;\n        var reverseY = this.findOne('.bottom-right').y() < this.findOne('.top-left').y() ? -1 : 1;\n        x = newHypotenuse * this.cos * reverseX;\n        y = newHypotenuse * this.sin * reverseY;\n        this.findOne('.bottom-left').x(this.findOne('.top-right').x() - x - padding * 2);\n        this.findOne('.bottom-left').y(y + padding);\n      }\n\n      pos = anchorNode.position();\n      this.findOne('.top-left').x(pos.x);\n      this.findOne('.bottom-right').y(pos.y);\n    } else if (this._movingAnchorName === 'bottom-center') {\n      this.findOne('.bottom-right').y(anchorNode.y());\n    } else if (this._movingAnchorName === 'bottom-right') {\n      if (keepProportion) {\n        newHypotenuse = Math.sqrt(Math.pow(this.findOne('.bottom-right').x() - padding, 2) + Math.pow(this.findOne('.bottom-right').y() - padding, 2));\n        var reverseX = this.findOne('.top-left').x() > this.findOne('.bottom-right').x() ? -1 : 1;\n        var reverseY = this.findOne('.top-left').y() > this.findOne('.bottom-right').y() ? -1 : 1;\n        x = newHypotenuse * this.cos * reverseX;\n        y = newHypotenuse * this.sin * reverseY;\n        this.findOne('.bottom-right').x(x + padding);\n        this.findOne('.bottom-right').y(y + padding);\n      }\n    } else if (this._movingAnchorName === 'rotater') {\n      var attrs = this._getNodeRect();\n\n      x = anchorNode.x() - attrs.width / 2;\n      y = -anchorNode.y() + attrs.height / 2;\n      var dAlpha = Math.atan2(-y, x) + Math.PI / 2;\n\n      if (attrs.height < 0) {\n        dAlpha -= Math.PI;\n      }\n\n      var rot = Global_1.Konva.getAngle(this.rotation());\n\n      var newRotation = Util_1.Util._radToDeg(rot) + Util_1.Util._radToDeg(dAlpha);\n\n      var alpha = Global_1.Konva.getAngle(this.getNode().rotation());\n\n      var newAlpha = Util_1.Util._degToRad(newRotation);\n\n      var snaps = this.rotationSnaps();\n      var offset = Global_1.Konva.getAngle(this.rotationSnapTolerance());\n\n      for (var i = 0; i < snaps.length; i++) {\n        var angle = Global_1.Konva.getAngle(snaps[i]);\n        var dif = Math.abs(angle - Util_1.Util._degToRad(newRotation)) % (Math.PI * 2);\n\n        if (dif < offset) {\n          newRotation = Util_1.Util._radToDeg(angle);\n          newAlpha = Util_1.Util._degToRad(newRotation);\n        }\n      }\n\n      var dx = padding;\n      var dy = padding;\n\n      this._fitNodeInto({\n        rotation: Global_1.Konva.angleDeg ? newRotation : Util_1.Util._degToRad(newRotation),\n        x: attrs.x + (attrs.width / 2 + padding) * (Math.cos(alpha) - Math.cos(newAlpha)) + (attrs.height / 2 + padding) * (Math.sin(-alpha) - Math.sin(-newAlpha)) - (dx * Math.cos(rot) + dy * Math.sin(-rot)),\n        y: attrs.y + (attrs.height / 2 + padding) * (Math.cos(alpha) - Math.cos(newAlpha)) + (attrs.width / 2 + padding) * (Math.sin(alpha) - Math.sin(newAlpha)) - (dy * Math.cos(rot) + dx * Math.sin(rot)),\n        width: attrs.width + padding * 2,\n        height: attrs.height + padding * 2\n      }, e);\n    } else {\n      console.error(new Error('Wrong position argument of selection resizer: ' + this._movingAnchorName));\n    }\n\n    if (this._movingAnchorName === 'rotater') {\n      return;\n    }\n\n    var centeredScaling = this.centeredScaling() || e.altKey;\n\n    if (centeredScaling) {\n      var topLeft = this.findOne('.top-left');\n      var bottomRight = this.findOne('.bottom-right');\n      var topOffsetX = topLeft.x() + padding;\n      var topOffsetY = topLeft.y() + padding;\n      var bottomOffsetX = this.getWidth() - bottomRight.x() + padding;\n      var bottomOffsetY = this.getHeight() - bottomRight.y() + padding;\n      bottomRight.move({\n        x: -topOffsetX,\n        y: -topOffsetY\n      });\n      topLeft.move({\n        x: bottomOffsetX,\n        y: bottomOffsetY\n      });\n    }\n\n    var absPos = this.findOne('.top-left').getAbsolutePosition(this.getParent());\n    x = absPos.x;\n    y = absPos.y;\n    var width = this.findOne('.bottom-right').x() - this.findOne('.top-left').x();\n    var height = this.findOne('.bottom-right').y() - this.findOne('.top-left').y();\n\n    this._fitNodeInto({\n      x: x + this.offsetX(),\n      y: y + this.offsetY(),\n      width: width,\n      height: height\n    }, e);\n  };\n\n  Transformer.prototype._handleMouseUp = function (e) {\n    this._removeEvents(e);\n  };\n\n  Transformer.prototype._removeEvents = function (e) {\n    if (this._transforming) {\n      this._transforming = false;\n      window.removeEventListener('mousemove', this._handleMouseMove);\n      window.removeEventListener('touchmove', this._handleMouseMove);\n      window.removeEventListener('mouseup', this._handleMouseUp, true);\n      window.removeEventListener('touchend', this._handleMouseUp, true);\n      var node = this.getNode();\n\n      this._fire('transformend', {\n        evt: e,\n        target: node\n      });\n\n      if (node) {\n        node.fire('transformend', {\n          evt: e,\n          target: node\n        });\n      }\n\n      this._movingAnchorName = null;\n    }\n  };\n\n  Transformer.prototype._fitNodeInto = function (newAttrs, evt) {\n    var boundBoxFunc = this.boundBoxFunc();\n\n    if (boundBoxFunc) {\n      var oldAttrs = this._getNodeRect();\n\n      newAttrs = boundBoxFunc.call(this, oldAttrs, newAttrs);\n    }\n\n    var node = this.getNode();\n\n    if (newAttrs.rotation !== undefined) {\n      this.getNode().rotation(newAttrs.rotation);\n    }\n\n    var pure = node.getClientRect({\n      skipTransform: true,\n      skipShadow: true,\n      skipStroke: this.ignoreStroke()\n    });\n    var padding = this.padding();\n    var scaleX = pure.width ? (newAttrs.width - padding * 2) / pure.width : 1;\n    var scaleY = pure.height ? (newAttrs.height - padding * 2) / pure.height : 1;\n    var rotation = Global_1.Konva.getAngle(node.rotation());\n    var dx = pure.x * scaleX - padding - node.offsetX() * scaleX;\n    var dy = pure.y * scaleY - padding - node.offsetY() * scaleY;\n    this.getNode().setAttrs({\n      scaleX: scaleX,\n      scaleY: scaleY,\n      x: newAttrs.x - (dx * Math.cos(rotation) + dy * Math.sin(-rotation)),\n      y: newAttrs.y - (dy * Math.cos(rotation) + dx * Math.sin(rotation))\n    });\n\n    this._fire('transform', {\n      evt: evt,\n      target: this.getNode()\n    });\n\n    this.getNode()._fire('transform', {\n      evt: evt,\n      target: this.getNode()\n    });\n\n    this.update();\n    this.getLayer().batchDraw();\n  };\n\n  Transformer.prototype.forceUpdate = function () {\n    this._resetTransformCache();\n\n    this.update();\n  };\n\n  Transformer.prototype.update = function () {\n    var _this = this;\n\n    var attrs = this._getNodeRect();\n\n    var node = this.getNode();\n    var scale = {\n      x: 1,\n      y: 1\n    };\n\n    if (node && node.getParent()) {\n      scale = node.getParent().getAbsoluteScale();\n    }\n\n    var invertedScale = {\n      x: 1 / scale.x,\n      y: 1 / scale.y\n    };\n    var width = attrs.width;\n    var height = attrs.height;\n    var enabledAnchors = this.enabledAnchors();\n    var resizeEnabled = this.resizeEnabled();\n    var padding = this.padding();\n    var anchorSize = this.anchorSize();\n    this.find('._anchor').each(function (node) {\n      return node.setAttrs({\n        width: anchorSize,\n        height: anchorSize,\n        offsetX: anchorSize / 2,\n        offsetY: anchorSize / 2,\n        stroke: _this.anchorStroke(),\n        strokeWidth: _this.anchorStrokeWidth(),\n        fill: _this.anchorFill(),\n        cornerRadius: _this.anchorCornerRadius()\n      });\n    });\n    this.findOne('.top-left').setAttrs({\n      x: -padding,\n      y: -padding,\n      scale: invertedScale,\n      visible: resizeEnabled && enabledAnchors.indexOf('top-left') >= 0\n    });\n    this.findOne('.top-center').setAttrs({\n      x: width / 2,\n      y: -padding,\n      scale: invertedScale,\n      visible: resizeEnabled && enabledAnchors.indexOf('top-center') >= 0\n    });\n    this.findOne('.top-right').setAttrs({\n      x: width + padding,\n      y: -padding,\n      scale: invertedScale,\n      visible: resizeEnabled && enabledAnchors.indexOf('top-right') >= 0\n    });\n    this.findOne('.middle-left').setAttrs({\n      x: -padding,\n      y: height / 2,\n      scale: invertedScale,\n      visible: resizeEnabled && enabledAnchors.indexOf('middle-left') >= 0\n    });\n    this.findOne('.middle-right').setAttrs({\n      x: width + padding,\n      y: height / 2,\n      scale: invertedScale,\n      visible: resizeEnabled && enabledAnchors.indexOf('middle-right') >= 0\n    });\n    this.findOne('.bottom-left').setAttrs({\n      x: -padding,\n      y: height + padding,\n      scale: invertedScale,\n      visible: resizeEnabled && enabledAnchors.indexOf('bottom-left') >= 0\n    });\n    this.findOne('.bottom-center').setAttrs({\n      x: width / 2,\n      y: height + padding,\n      scale: invertedScale,\n      visible: resizeEnabled && enabledAnchors.indexOf('bottom-center') >= 0\n    });\n    this.findOne('.bottom-right').setAttrs({\n      x: width + padding,\n      y: height + padding,\n      scale: invertedScale,\n      visible: resizeEnabled && enabledAnchors.indexOf('bottom-right') >= 0\n    });\n    var scaledRotateAnchorOffset = -this.rotateAnchorOffset() * Math.abs(invertedScale.y);\n    this.findOne('.rotater').setAttrs({\n      x: width / 2,\n      y: scaledRotateAnchorOffset * Util_1.Util._sign(height) - padding,\n      scale: invertedScale,\n      visible: this.rotateEnabled()\n    });\n    this.findOne('.back').setAttrs({\n      width: width * scale.x,\n      height: height * scale.y,\n      scale: invertedScale,\n      visible: this.borderEnabled(),\n      stroke: this.borderStroke(),\n      strokeWidth: this.borderStrokeWidth(),\n      dash: this.borderDash()\n    });\n  };\n\n  Transformer.prototype.isTransforming = function () {\n    return this._transforming;\n  };\n\n  Transformer.prototype.stopTransform = function () {\n    if (this._transforming) {\n      this._removeEvents();\n\n      var anchorNode = this.findOne('.' + this._movingAnchorName);\n\n      if (anchorNode) {\n        anchorNode.stopDrag();\n      }\n    }\n  };\n\n  Transformer.prototype.destroy = function () {\n    if (this.getStage() && this._cursorChange) {\n      this.getStage().content.style.cursor = '';\n    }\n\n    Group_1.Group.prototype.destroy.call(this);\n    this.detach();\n\n    this._removeEvents();\n\n    return this;\n  };\n\n  Transformer.prototype.toObject = function () {\n    return Node_1.Node.prototype.toObject.call(this);\n  };\n\n  return Transformer;\n}(Group_1.Group);\n\nexports.Transformer = Transformer;\n\nfunction validateAnchors(val) {\n  if (!(val instanceof Array)) {\n    Util_1.Util.warn('enabledAnchors value should be an array');\n  }\n\n  if (val instanceof Array) {\n    val.forEach(function (name) {\n      if (ANCHORS_NAMES.indexOf(name) === -1) {\n        Util_1.Util.warn('Unknown anchor name: ' + name + '. Available names are: ' + ANCHORS_NAMES.join(', '));\n      }\n    });\n  }\n\n  return val || [];\n}\n\nTransformer.prototype.className = 'Transformer';\n\nGlobal_2._registerNode(Transformer);\n\nFactory_1.Factory.addGetterSetter(Transformer, 'enabledAnchors', ANCHORS_NAMES, validateAnchors);\nFactory_1.Factory.addGetterSetter(Transformer, 'resizeEnabled', true);\nFactory_1.Factory.addGetterSetter(Transformer, 'anchorSize', 10, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'rotateEnabled', true);\nFactory_1.Factory.addGetterSetter(Transformer, 'rotationSnaps', []);\nFactory_1.Factory.addGetterSetter(Transformer, 'rotateAnchorOffset', 50, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'rotationSnapTolerance', 5, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'borderEnabled', true);\nFactory_1.Factory.addGetterSetter(Transformer, 'anchorStroke', 'rgb(0, 161, 255)');\nFactory_1.Factory.addGetterSetter(Transformer, 'anchorStrokeWidth', 1, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'anchorFill', 'white');\nFactory_1.Factory.addGetterSetter(Transformer, 'anchorCornerRadius', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'borderStroke', 'rgb(0, 161, 255)');\nFactory_1.Factory.addGetterSetter(Transformer, 'borderStrokeWidth', 1, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'borderDash');\nFactory_1.Factory.addGetterSetter(Transformer, 'keepRatio', true);\nFactory_1.Factory.addGetterSetter(Transformer, 'centeredScaling', false);\nFactory_1.Factory.addGetterSetter(Transformer, 'ignoreStroke', false);\nFactory_1.Factory.addGetterSetter(Transformer, 'padding', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'node');\nFactory_1.Factory.addGetterSetter(Transformer, 'boundBoxFunc');\nFactory_1.Factory.backCompat(Transformer, {\n  lineEnabled: 'borderEnabled',\n  rotateHandlerOffset: 'rotateAnchorOffset',\n  enabledHandlers: 'enabledAnchors'\n});\nUtil_1.Collection.mapMethods(Transformer);","map":{"version":3,"sources":["C:/Users/Miaomiao/interestminer/frontend/node_modules/konva/lib/shapes/Transformer.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","defineProperty","exports","value","Util_1","require","Factory_1","Node_1","Shape_1","Rect_1","Group_1","Global_1","Validators_1","Global_2","EVENTS_NAME","ATTR_CHANGE_LIST","map","e","join","NODE_RECT","TRANSFORM_CHANGE_STR","ANGLES","TOUCH_DEVICE","Konva","_global","getCursor","anchorName","rad","isMirrored","Util","_degToRad","angle","_radToDeg","_inRange","error","ANCHORS_NAMES","MAX_SAFE_INTEGER","Transformer","_super","config","_this","call","_transforming","_createElements","_handleMouseMove","bind","_handleMouseUp","update","on","getNode","attachTo","node","setNode","_node","detach","_resetTransformCache","additionalEvents","_attrsAffectingSize","prop","onChange","elementsCreated","findOne","getActiveAnchor","_movingAnchorName","off","undefined","_clearCache","_clearSelfAndDescendantCache","_getNodeRect","_getCache","__getNodeRect","x","y","width","height","rotation","parent","warn","rect","getClientRect","skipTransform","skipShadow","skipStroke","ignoreStroke","getAngle","dx","scaleX","offsetX","dy","scaleY","offsetY","Math","cos","sin","getX","getY","getRotation","getWidth","getHeight","_createBack","forEach","name","_createAnchor","anchor","Rect","stroke","fill","strokeWidth","dragDistance","draggable","hitStrokeWidth","self","_handleMouseDown","cancelBubble","getAbsoluteRotation","scale","getAbsoluteScale","cursor","getStage","content","style","_cursorChange","getParent","add","back","Shape","listening","sceneFunc","ctx","tr","padding","beginPath","moveTo","rotateEnabled","lineTo","rotateAnchorOffset","_sign","fillStrokeShape","target","split","attrs","hypotenuse","sqrt","pow","abs","window","addEventListener","_fire","evt","newHypotenuse","anchorNode","stage","setPointersPositions","setAbsolutePosition","getPointerPosition","keepProportion","keepRatio","shiftKey","reverseX","reverseY","pos","position","dAlpha","atan2","PI","rot","newRotation","alpha","newAlpha","snaps","rotationSnaps","offset","rotationSnapTolerance","i","length","dif","_fitNodeInto","angleDeg","console","Error","centeredScaling","altKey","topLeft","bottomRight","topOffsetX","topOffsetY","bottomOffsetX","bottomOffsetY","move","absPos","getAbsolutePosition","_removeEvents","removeEventListener","fire","newAttrs","boundBoxFunc","oldAttrs","pure","setAttrs","getLayer","batchDraw","forceUpdate","invertedScale","enabledAnchors","resizeEnabled","anchorSize","find","each","anchorStroke","anchorStrokeWidth","anchorFill","cornerRadius","anchorCornerRadius","visible","indexOf","scaledRotateAnchorOffset","borderEnabled","borderStroke","borderStrokeWidth","dash","borderDash","isTransforming","stopTransform","stopDrag","destroy","Group","toObject","Node","validateAnchors","val","className","_registerNode","Factory","addGetterSetter","getNumberValidator","backCompat","lineEnabled","rotateHandlerOffset","enabledHandlers","Collection","mapMethods"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Util_1 = require(\"../Util\");\nvar Factory_1 = require(\"../Factory\");\nvar Node_1 = require(\"../Node\");\nvar Shape_1 = require(\"../Shape\");\nvar Rect_1 = require(\"./Rect\");\nvar Group_1 = require(\"../Group\");\nvar Global_1 = require(\"../Global\");\nvar Validators_1 = require(\"../Validators\");\nvar Global_2 = require(\"../Global\");\nvar EVENTS_NAME = 'tr-konva';\nvar ATTR_CHANGE_LIST = [\n    'resizeEnabledChange',\n    'rotateAnchorOffsetChange',\n    'rotateEnabledChange',\n    'enabledAnchorsChange',\n    'anchorSizeChange',\n    'borderEnabledChange',\n    'borderStrokeChange',\n    'borderStrokeWidthChange',\n    'borderDashChange',\n    'anchorStrokeChange',\n    'anchorStrokeWidthChange',\n    'anchorFillChange',\n    'anchorCornerRadiusChange',\n    'ignoreStrokeChange'\n]\n    .map(function (e) { return e + (\".\" + EVENTS_NAME); })\n    .join(' ');\nvar NODE_RECT = 'nodeRect';\nvar TRANSFORM_CHANGE_STR = [\n    'widthChange',\n    'heightChange',\n    'scaleXChange',\n    'scaleYChange',\n    'skewXChange',\n    'skewYChange',\n    'rotationChange',\n    'offsetXChange',\n    'offsetYChange',\n    'transformsEnabledChange',\n    'strokeWidthChange'\n]\n    .map(function (e) { return e + (\".\" + EVENTS_NAME); })\n    .join(' ');\nvar ANGLES = {\n    'top-left': -45,\n    'top-center': 0,\n    'top-right': 45,\n    'middle-right': -90,\n    'middle-left': 90,\n    'bottom-left': -135,\n    'bottom-center': 180,\n    'bottom-right': 135\n};\nvar TOUCH_DEVICE = 'ontouchstart' in Global_1.Konva._global;\nfunction getCursor(anchorName, rad, isMirrored) {\n    if (anchorName === 'rotater') {\n        return 'crosshair';\n    }\n    rad += Util_1.Util._degToRad(ANGLES[anchorName] || 0);\n    if (isMirrored) {\n        rad *= -1;\n    }\n    var angle = ((Util_1.Util._radToDeg(rad) % 360) + 360) % 360;\n    if (Util_1.Util._inRange(angle, 315 + 22.5, 360) || Util_1.Util._inRange(angle, 0, 22.5)) {\n        return 'ns-resize';\n    }\n    else if (Util_1.Util._inRange(angle, 45 - 22.5, 45 + 22.5)) {\n        return 'nesw-resize';\n    }\n    else if (Util_1.Util._inRange(angle, 90 - 22.5, 90 + 22.5)) {\n        return 'ew-resize';\n    }\n    else if (Util_1.Util._inRange(angle, 135 - 22.5, 135 + 22.5)) {\n        return 'nwse-resize';\n    }\n    else if (Util_1.Util._inRange(angle, 180 - 22.5, 180 + 22.5)) {\n        return 'ns-resize';\n    }\n    else if (Util_1.Util._inRange(angle, 225 - 22.5, 225 + 22.5)) {\n        return 'nesw-resize';\n    }\n    else if (Util_1.Util._inRange(angle, 270 - 22.5, 270 + 22.5)) {\n        return 'ew-resize';\n    }\n    else if (Util_1.Util._inRange(angle, 315 - 22.5, 315 + 22.5)) {\n        return 'nwse-resize';\n    }\n    else {\n        Util_1.Util.error('Transformer has unknown angle for cursor detection: ' + angle);\n        return 'pointer';\n    }\n}\nvar ANCHORS_NAMES = [\n    'top-left',\n    'top-center',\n    'top-right',\n    'middle-right',\n    'middle-left',\n    'bottom-left',\n    'bottom-center',\n    'bottom-right'\n];\nvar MAX_SAFE_INTEGER = 100000000;\nvar Transformer = (function (_super) {\n    __extends(Transformer, _super);\n    function Transformer(config) {\n        var _this = _super.call(this, config) || this;\n        _this._transforming = false;\n        _this._createElements();\n        _this._handleMouseMove = _this._handleMouseMove.bind(_this);\n        _this._handleMouseUp = _this._handleMouseUp.bind(_this);\n        _this.update = _this.update.bind(_this);\n        _this.on(ATTR_CHANGE_LIST, _this.update);\n        if (_this.getNode()) {\n            _this.update();\n        }\n        return _this;\n    }\n    Transformer.prototype.attachTo = function (node) {\n        this.setNode(node);\n        return this;\n    };\n    Transformer.prototype.setNode = function (node) {\n        var _this = this;\n        if (this._node) {\n            this.detach();\n        }\n        this._node = node;\n        this._resetTransformCache();\n        var additionalEvents = node._attrsAffectingSize\n            .map(function (prop) { return prop + 'Change.' + EVENTS_NAME; })\n            .join(' ');\n        var onChange = function () {\n            _this._resetTransformCache();\n            if (!_this._transforming) {\n                _this.update();\n            }\n        };\n        node.on(additionalEvents, onChange);\n        node.on(TRANSFORM_CHANGE_STR, onChange);\n        node.on(\"xChange.\" + EVENTS_NAME + \" yChange.\" + EVENTS_NAME, function () {\n            return _this._resetTransformCache();\n        });\n        var elementsCreated = !!this.findOne('.top-left');\n        if (elementsCreated) {\n            this.update();\n        }\n        return this;\n    };\n    Transformer.prototype.getNode = function () {\n        return this._node;\n    };\n    Transformer.prototype.getActiveAnchor = function () {\n        return this._movingAnchorName;\n    };\n    Transformer.prototype.detach = function () {\n        if (this.getNode()) {\n            this.getNode().off('.' + EVENTS_NAME);\n            this._node = undefined;\n        }\n        this._resetTransformCache();\n    };\n    Transformer.prototype._resetTransformCache = function () {\n        this._clearCache(NODE_RECT);\n        this._clearCache('transform');\n        this._clearSelfAndDescendantCache('absoluteTransform');\n    };\n    Transformer.prototype._getNodeRect = function () {\n        return this._getCache(NODE_RECT, this.__getNodeRect);\n    };\n    Transformer.prototype.__getNodeRect = function () {\n        var node = this.getNode();\n        if (!node) {\n            return {\n                x: -MAX_SAFE_INTEGER,\n                y: -MAX_SAFE_INTEGER,\n                width: 0,\n                height: 0,\n                rotation: 0\n            };\n        }\n        if (node.parent && this.parent && node.parent !== this.parent) {\n            Util_1.Util.warn('Transformer and attached node have different parents. Konva does not support such case right now. Please move Transformer to the parent of attaching node.');\n        }\n        var rect = node.getClientRect({\n            skipTransform: true,\n            skipShadow: true,\n            skipStroke: this.ignoreStroke()\n        });\n        var rotation = Global_1.Konva.getAngle(node.rotation());\n        var dx = rect.x * node.scaleX() - node.offsetX() * node.scaleX();\n        var dy = rect.y * node.scaleY() - node.offsetY() * node.scaleY();\n        return {\n            x: node.x() + dx * Math.cos(rotation) + dy * Math.sin(-rotation),\n            y: node.y() + dy * Math.cos(rotation) + dx * Math.sin(rotation),\n            width: rect.width * node.scaleX(),\n            height: rect.height * node.scaleY(),\n            rotation: node.rotation()\n        };\n    };\n    Transformer.prototype.getX = function () {\n        return this._getNodeRect().x;\n    };\n    Transformer.prototype.getY = function () {\n        return this._getNodeRect().y;\n    };\n    Transformer.prototype.getRotation = function () {\n        return this._getNodeRect().rotation;\n    };\n    Transformer.prototype.getWidth = function () {\n        return this._getNodeRect().width;\n    };\n    Transformer.prototype.getHeight = function () {\n        return this._getNodeRect().height;\n    };\n    Transformer.prototype._createElements = function () {\n        this._createBack();\n        ANCHORS_NAMES.forEach(function (name) {\n            this._createAnchor(name);\n        }.bind(this));\n        this._createAnchor('rotater');\n    };\n    Transformer.prototype._createAnchor = function (name) {\n        var _this = this;\n        var anchor = new Rect_1.Rect({\n            stroke: 'rgb(0, 161, 255)',\n            fill: 'white',\n            strokeWidth: 1,\n            name: name + ' _anchor',\n            dragDistance: 0,\n            draggable: true,\n            hitStrokeWidth: TOUCH_DEVICE ? 10 : 'auto'\n        });\n        var self = this;\n        anchor.on('mousedown touchstart', function (e) {\n            self._handleMouseDown(e);\n        });\n        anchor.on('dragstart', function (e) {\n            e.cancelBubble = true;\n        });\n        anchor.on('dragmove', function (e) {\n            e.cancelBubble = true;\n        });\n        anchor.on('dragend', function (e) {\n            e.cancelBubble = true;\n        });\n        anchor.on('mouseenter', function () {\n            var rad = Global_1.Konva.getAngle(_this.getAbsoluteRotation());\n            var scale = _this.getNode().getAbsoluteScale();\n            var isMirrored = scale.y * scale.x < 0;\n            var cursor = getCursor(name, rad, isMirrored);\n            anchor.getStage().content.style.cursor = cursor;\n            _this._cursorChange = true;\n        });\n        anchor.on('mouseout', function () {\n            if (!anchor.getStage() || !anchor.getParent()) {\n                return;\n            }\n            anchor.getStage().content.style.cursor = '';\n            _this._cursorChange = false;\n        });\n        this.add(anchor);\n    };\n    Transformer.prototype._createBack = function () {\n        var back = new Shape_1.Shape({\n            name: 'back',\n            width: 0,\n            height: 0,\n            listening: false,\n            sceneFunc: function (ctx) {\n                var tr = this.getParent();\n                var padding = tr.padding();\n                ctx.beginPath();\n                ctx.rect(-padding, -padding, this.width() + padding * 2, this.height() + padding * 2);\n                ctx.moveTo(this.width() / 2, -padding);\n                if (tr.rotateEnabled()) {\n                    ctx.lineTo(this.width() / 2, -tr.rotateAnchorOffset() * Util_1.Util._sign(this.height()) - padding);\n                }\n                ctx.fillStrokeShape(this);\n            }\n        });\n        this.add(back);\n    };\n    Transformer.prototype._handleMouseDown = function (e) {\n        this._movingAnchorName = e.target.name().split(' ')[0];\n        var attrs = this._getNodeRect();\n        var width = attrs.width;\n        var height = attrs.height;\n        var hypotenuse = Math.sqrt(Math.pow(width, 2) + Math.pow(height, 2));\n        this.sin = Math.abs(height / hypotenuse);\n        this.cos = Math.abs(width / hypotenuse);\n        window.addEventListener('mousemove', this._handleMouseMove);\n        window.addEventListener('touchmove', this._handleMouseMove);\n        window.addEventListener('mouseup', this._handleMouseUp, true);\n        window.addEventListener('touchend', this._handleMouseUp, true);\n        this._transforming = true;\n        this._fire('transformstart', { evt: e, target: this.getNode() });\n        this.getNode()._fire('transformstart', { evt: e, target: this.getNode() });\n    };\n    Transformer.prototype._handleMouseMove = function (e) {\n        var x, y, newHypotenuse;\n        var anchorNode = this.findOne('.' + this._movingAnchorName);\n        var stage = anchorNode.getStage();\n        stage.setPointersPositions(e);\n        anchorNode.setAbsolutePosition(stage.getPointerPosition());\n        var keepProportion = this.keepRatio() || e.shiftKey;\n        var padding = this.padding();\n        if (this._movingAnchorName === 'top-left') {\n            if (keepProportion) {\n                newHypotenuse = Math.sqrt(Math.pow(this.findOne('.bottom-right').x() - anchorNode.x() - padding * 2, 2) +\n                    Math.pow(this.findOne('.bottom-right').y() - anchorNode.y() - padding * 2, 2));\n                var reverseX = this.findOne('.top-left').x() > this.findOne('.bottom-right').x()\n                    ? -1\n                    : 1;\n                var reverseY = this.findOne('.top-left').y() > this.findOne('.bottom-right').y()\n                    ? -1\n                    : 1;\n                x = newHypotenuse * this.cos * reverseX;\n                y = newHypotenuse * this.sin * reverseY;\n                this.findOne('.top-left').x(this.findOne('.bottom-right').x() - x - padding * 2);\n                this.findOne('.top-left').y(this.findOne('.bottom-right').y() - y - padding * 2);\n            }\n        }\n        else if (this._movingAnchorName === 'top-center') {\n            this.findOne('.top-left').y(anchorNode.y());\n        }\n        else if (this._movingAnchorName === 'top-right') {\n            if (keepProportion) {\n                newHypotenuse = Math.sqrt(Math.pow(anchorNode.x() - this.findOne('.bottom-left').x() - padding * 2, 2) +\n                    Math.pow(this.findOne('.bottom-left').y() - anchorNode.y() - padding * 2, 2));\n                var reverseX = this.findOne('.top-right').x() < this.findOne('.top-left').x()\n                    ? -1\n                    : 1;\n                var reverseY = this.findOne('.top-right').y() > this.findOne('.bottom-left').y()\n                    ? -1\n                    : 1;\n                x = newHypotenuse * this.cos * reverseX;\n                y = newHypotenuse * this.sin * reverseY;\n                this.findOne('.top-right').x(x + padding);\n                this.findOne('.top-right').y(this.findOne('.bottom-left').y() - y - padding * 2);\n            }\n            var pos = anchorNode.position();\n            this.findOne('.top-left').y(pos.y);\n            this.findOne('.bottom-right').x(pos.x);\n        }\n        else if (this._movingAnchorName === 'middle-left') {\n            this.findOne('.top-left').x(anchorNode.x());\n        }\n        else if (this._movingAnchorName === 'middle-right') {\n            this.findOne('.bottom-right').x(anchorNode.x());\n        }\n        else if (this._movingAnchorName === 'bottom-left') {\n            if (keepProportion) {\n                newHypotenuse = Math.sqrt(Math.pow(this.findOne('.top-right').x() - anchorNode.x() - padding * 2, 2) +\n                    Math.pow(anchorNode.y() - this.findOne('.top-right').y() - padding * 2, 2));\n                var reverseX = this.findOne('.top-right').x() < this.findOne('.bottom-left').x()\n                    ? -1\n                    : 1;\n                var reverseY = this.findOne('.bottom-right').y() < this.findOne('.top-left').y()\n                    ? -1\n                    : 1;\n                x = newHypotenuse * this.cos * reverseX;\n                y = newHypotenuse * this.sin * reverseY;\n                this.findOne('.bottom-left').x(this.findOne('.top-right').x() - x - padding * 2);\n                this.findOne('.bottom-left').y(y + padding);\n            }\n            pos = anchorNode.position();\n            this.findOne('.top-left').x(pos.x);\n            this.findOne('.bottom-right').y(pos.y);\n        }\n        else if (this._movingAnchorName === 'bottom-center') {\n            this.findOne('.bottom-right').y(anchorNode.y());\n        }\n        else if (this._movingAnchorName === 'bottom-right') {\n            if (keepProportion) {\n                newHypotenuse = Math.sqrt(Math.pow(this.findOne('.bottom-right').x() - padding, 2) +\n                    Math.pow(this.findOne('.bottom-right').y() - padding, 2));\n                var reverseX = this.findOne('.top-left').x() > this.findOne('.bottom-right').x()\n                    ? -1\n                    : 1;\n                var reverseY = this.findOne('.top-left').y() > this.findOne('.bottom-right').y()\n                    ? -1\n                    : 1;\n                x = newHypotenuse * this.cos * reverseX;\n                y = newHypotenuse * this.sin * reverseY;\n                this.findOne('.bottom-right').x(x + padding);\n                this.findOne('.bottom-right').y(y + padding);\n            }\n        }\n        else if (this._movingAnchorName === 'rotater') {\n            var attrs = this._getNodeRect();\n            x = anchorNode.x() - attrs.width / 2;\n            y = -anchorNode.y() + attrs.height / 2;\n            var dAlpha = Math.atan2(-y, x) + Math.PI / 2;\n            if (attrs.height < 0) {\n                dAlpha -= Math.PI;\n            }\n            var rot = Global_1.Konva.getAngle(this.rotation());\n            var newRotation = Util_1.Util._radToDeg(rot) + Util_1.Util._radToDeg(dAlpha);\n            var alpha = Global_1.Konva.getAngle(this.getNode().rotation());\n            var newAlpha = Util_1.Util._degToRad(newRotation);\n            var snaps = this.rotationSnaps();\n            var offset = Global_1.Konva.getAngle(this.rotationSnapTolerance());\n            for (var i = 0; i < snaps.length; i++) {\n                var angle = Global_1.Konva.getAngle(snaps[i]);\n                var dif = Math.abs(angle - Util_1.Util._degToRad(newRotation)) % (Math.PI * 2);\n                if (dif < offset) {\n                    newRotation = Util_1.Util._radToDeg(angle);\n                    newAlpha = Util_1.Util._degToRad(newRotation);\n                }\n            }\n            var dx = padding;\n            var dy = padding;\n            this._fitNodeInto({\n                rotation: Global_1.Konva.angleDeg ? newRotation : Util_1.Util._degToRad(newRotation),\n                x: attrs.x +\n                    (attrs.width / 2 + padding) *\n                        (Math.cos(alpha) - Math.cos(newAlpha)) +\n                    (attrs.height / 2 + padding) *\n                        (Math.sin(-alpha) - Math.sin(-newAlpha)) -\n                    (dx * Math.cos(rot) + dy * Math.sin(-rot)),\n                y: attrs.y +\n                    (attrs.height / 2 + padding) *\n                        (Math.cos(alpha) - Math.cos(newAlpha)) +\n                    (attrs.width / 2 + padding) *\n                        (Math.sin(alpha) - Math.sin(newAlpha)) -\n                    (dy * Math.cos(rot) + dx * Math.sin(rot)),\n                width: attrs.width + padding * 2,\n                height: attrs.height + padding * 2\n            }, e);\n        }\n        else {\n            console.error(new Error('Wrong position argument of selection resizer: ' +\n                this._movingAnchorName));\n        }\n        if (this._movingAnchorName === 'rotater') {\n            return;\n        }\n        var centeredScaling = this.centeredScaling() || e.altKey;\n        if (centeredScaling) {\n            var topLeft = this.findOne('.top-left');\n            var bottomRight = this.findOne('.bottom-right');\n            var topOffsetX = topLeft.x() + padding;\n            var topOffsetY = topLeft.y() + padding;\n            var bottomOffsetX = this.getWidth() - bottomRight.x() + padding;\n            var bottomOffsetY = this.getHeight() - bottomRight.y() + padding;\n            bottomRight.move({\n                x: -topOffsetX,\n                y: -topOffsetY\n            });\n            topLeft.move({\n                x: bottomOffsetX,\n                y: bottomOffsetY\n            });\n        }\n        var absPos = this.findOne('.top-left').getAbsolutePosition(this.getParent());\n        x = absPos.x;\n        y = absPos.y;\n        var width = this.findOne('.bottom-right').x() - this.findOne('.top-left').x();\n        var height = this.findOne('.bottom-right').y() - this.findOne('.top-left').y();\n        this._fitNodeInto({\n            x: x + this.offsetX(),\n            y: y + this.offsetY(),\n            width: width,\n            height: height\n        }, e);\n    };\n    Transformer.prototype._handleMouseUp = function (e) {\n        this._removeEvents(e);\n    };\n    Transformer.prototype._removeEvents = function (e) {\n        if (this._transforming) {\n            this._transforming = false;\n            window.removeEventListener('mousemove', this._handleMouseMove);\n            window.removeEventListener('touchmove', this._handleMouseMove);\n            window.removeEventListener('mouseup', this._handleMouseUp, true);\n            window.removeEventListener('touchend', this._handleMouseUp, true);\n            var node = this.getNode();\n            this._fire('transformend', { evt: e, target: node });\n            if (node) {\n                node.fire('transformend', { evt: e, target: node });\n            }\n            this._movingAnchorName = null;\n        }\n    };\n    Transformer.prototype._fitNodeInto = function (newAttrs, evt) {\n        var boundBoxFunc = this.boundBoxFunc();\n        if (boundBoxFunc) {\n            var oldAttrs = this._getNodeRect();\n            newAttrs = boundBoxFunc.call(this, oldAttrs, newAttrs);\n        }\n        var node = this.getNode();\n        if (newAttrs.rotation !== undefined) {\n            this.getNode().rotation(newAttrs.rotation);\n        }\n        var pure = node.getClientRect({\n            skipTransform: true,\n            skipShadow: true,\n            skipStroke: this.ignoreStroke()\n        });\n        var padding = this.padding();\n        var scaleX = pure.width ? (newAttrs.width - padding * 2) / pure.width : 1;\n        var scaleY = pure.height\n            ? (newAttrs.height - padding * 2) / pure.height\n            : 1;\n        var rotation = Global_1.Konva.getAngle(node.rotation());\n        var dx = pure.x * scaleX - padding - node.offsetX() * scaleX;\n        var dy = pure.y * scaleY - padding - node.offsetY() * scaleY;\n        this.getNode().setAttrs({\n            scaleX: scaleX,\n            scaleY: scaleY,\n            x: newAttrs.x - (dx * Math.cos(rotation) + dy * Math.sin(-rotation)),\n            y: newAttrs.y - (dy * Math.cos(rotation) + dx * Math.sin(rotation))\n        });\n        this._fire('transform', { evt: evt, target: this.getNode() });\n        this.getNode()._fire('transform', { evt: evt, target: this.getNode() });\n        this.update();\n        this.getLayer().batchDraw();\n    };\n    Transformer.prototype.forceUpdate = function () {\n        this._resetTransformCache();\n        this.update();\n    };\n    Transformer.prototype.update = function () {\n        var _this = this;\n        var attrs = this._getNodeRect();\n        var node = this.getNode();\n        var scale = { x: 1, y: 1 };\n        if (node && node.getParent()) {\n            scale = node.getParent().getAbsoluteScale();\n        }\n        var invertedScale = {\n            x: 1 / scale.x,\n            y: 1 / scale.y\n        };\n        var width = attrs.width;\n        var height = attrs.height;\n        var enabledAnchors = this.enabledAnchors();\n        var resizeEnabled = this.resizeEnabled();\n        var padding = this.padding();\n        var anchorSize = this.anchorSize();\n        this.find('._anchor').each(function (node) {\n            return node.setAttrs({\n                width: anchorSize,\n                height: anchorSize,\n                offsetX: anchorSize / 2,\n                offsetY: anchorSize / 2,\n                stroke: _this.anchorStroke(),\n                strokeWidth: _this.anchorStrokeWidth(),\n                fill: _this.anchorFill(),\n                cornerRadius: _this.anchorCornerRadius()\n            });\n        });\n        this.findOne('.top-left').setAttrs({\n            x: -padding,\n            y: -padding,\n            scale: invertedScale,\n            visible: resizeEnabled && enabledAnchors.indexOf('top-left') >= 0\n        });\n        this.findOne('.top-center').setAttrs({\n            x: width / 2,\n            y: -padding,\n            scale: invertedScale,\n            visible: resizeEnabled && enabledAnchors.indexOf('top-center') >= 0\n        });\n        this.findOne('.top-right').setAttrs({\n            x: width + padding,\n            y: -padding,\n            scale: invertedScale,\n            visible: resizeEnabled && enabledAnchors.indexOf('top-right') >= 0\n        });\n        this.findOne('.middle-left').setAttrs({\n            x: -padding,\n            y: height / 2,\n            scale: invertedScale,\n            visible: resizeEnabled && enabledAnchors.indexOf('middle-left') >= 0\n        });\n        this.findOne('.middle-right').setAttrs({\n            x: width + padding,\n            y: height / 2,\n            scale: invertedScale,\n            visible: resizeEnabled && enabledAnchors.indexOf('middle-right') >= 0\n        });\n        this.findOne('.bottom-left').setAttrs({\n            x: -padding,\n            y: height + padding,\n            scale: invertedScale,\n            visible: resizeEnabled && enabledAnchors.indexOf('bottom-left') >= 0\n        });\n        this.findOne('.bottom-center').setAttrs({\n            x: width / 2,\n            y: height + padding,\n            scale: invertedScale,\n            visible: resizeEnabled && enabledAnchors.indexOf('bottom-center') >= 0\n        });\n        this.findOne('.bottom-right').setAttrs({\n            x: width + padding,\n            y: height + padding,\n            scale: invertedScale,\n            visible: resizeEnabled && enabledAnchors.indexOf('bottom-right') >= 0\n        });\n        var scaledRotateAnchorOffset = -this.rotateAnchorOffset() * Math.abs(invertedScale.y);\n        this.findOne('.rotater').setAttrs({\n            x: width / 2,\n            y: scaledRotateAnchorOffset * Util_1.Util._sign(height) - padding,\n            scale: invertedScale,\n            visible: this.rotateEnabled()\n        });\n        this.findOne('.back').setAttrs({\n            width: width * scale.x,\n            height: height * scale.y,\n            scale: invertedScale,\n            visible: this.borderEnabled(),\n            stroke: this.borderStroke(),\n            strokeWidth: this.borderStrokeWidth(),\n            dash: this.borderDash()\n        });\n    };\n    Transformer.prototype.isTransforming = function () {\n        return this._transforming;\n    };\n    Transformer.prototype.stopTransform = function () {\n        if (this._transforming) {\n            this._removeEvents();\n            var anchorNode = this.findOne('.' + this._movingAnchorName);\n            if (anchorNode) {\n                anchorNode.stopDrag();\n            }\n        }\n    };\n    Transformer.prototype.destroy = function () {\n        if (this.getStage() && this._cursorChange) {\n            this.getStage().content.style.cursor = '';\n        }\n        Group_1.Group.prototype.destroy.call(this);\n        this.detach();\n        this._removeEvents();\n        return this;\n    };\n    Transformer.prototype.toObject = function () {\n        return Node_1.Node.prototype.toObject.call(this);\n    };\n    return Transformer;\n}(Group_1.Group));\nexports.Transformer = Transformer;\nfunction validateAnchors(val) {\n    if (!(val instanceof Array)) {\n        Util_1.Util.warn('enabledAnchors value should be an array');\n    }\n    if (val instanceof Array) {\n        val.forEach(function (name) {\n            if (ANCHORS_NAMES.indexOf(name) === -1) {\n                Util_1.Util.warn('Unknown anchor name: ' +\n                    name +\n                    '. Available names are: ' +\n                    ANCHORS_NAMES.join(', '));\n            }\n        });\n    }\n    return val || [];\n}\nTransformer.prototype.className = 'Transformer';\nGlobal_2._registerNode(Transformer);\nFactory_1.Factory.addGetterSetter(Transformer, 'enabledAnchors', ANCHORS_NAMES, validateAnchors);\nFactory_1.Factory.addGetterSetter(Transformer, 'resizeEnabled', true);\nFactory_1.Factory.addGetterSetter(Transformer, 'anchorSize', 10, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'rotateEnabled', true);\nFactory_1.Factory.addGetterSetter(Transformer, 'rotationSnaps', []);\nFactory_1.Factory.addGetterSetter(Transformer, 'rotateAnchorOffset', 50, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'rotationSnapTolerance', 5, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'borderEnabled', true);\nFactory_1.Factory.addGetterSetter(Transformer, 'anchorStroke', 'rgb(0, 161, 255)');\nFactory_1.Factory.addGetterSetter(Transformer, 'anchorStrokeWidth', 1, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'anchorFill', 'white');\nFactory_1.Factory.addGetterSetter(Transformer, 'anchorCornerRadius', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'borderStroke', 'rgb(0, 161, 255)');\nFactory_1.Factory.addGetterSetter(Transformer, 'borderStrokeWidth', 1, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'borderDash');\nFactory_1.Factory.addGetterSetter(Transformer, 'keepRatio', true);\nFactory_1.Factory.addGetterSetter(Transformer, 'centeredScaling', false);\nFactory_1.Factory.addGetterSetter(Transformer, 'ignoreStroke', false);\nFactory_1.Factory.addGetterSetter(Transformer, 'padding', 0, Validators_1.getNumberValidator());\nFactory_1.Factory.addGetterSetter(Transformer, 'node');\nFactory_1.Factory.addGetterSetter(Transformer, 'boundBoxFunc');\nFactory_1.Factory.backCompat(Transformer, {\n    lineEnabled: 'borderEnabled',\n    rotateHandlerOffset: 'rotateAnchorOffset',\n    enabledHandlers: 'enabledAnchors'\n});\nUtil_1.Collection.mapMethods(Transformer);\n"]},"metadata":{},"sourceType":"script"}